(function () {
    const STORAGE_KEY = 'simpleViewMode';
    const BODY_CLASS = 'simple-view';
    const BTN_ID = 'headerSimpleBtn';

    // SVGs provided by user
    // Icon 1 (Complex/Default State - Click to Simplify)
    // 600x300 original viewBox. centered in 48x48 container via classes.
    const ICON_COMPLEX = `<svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 600 300" fill="currentColor">
<g>
<path d="M 322.18 227.99 C312.25,229.43 284.66,229.09 277.00,227.44 C244.30,220.38 217.97,207.11 189.07,183.14 C179.69,175.36 163.32,158.47 159.48,152.61 C157.82,150.08 157.85,150.02 165.27,141.28 C193.10,108.51 230.76,84.90 271.50,74.68 C312.61,64.37 355.79,76.07 400.90,109.72 C411.95,117.97 436.19,141.00 440.78,147.61 L 442.93 150.71 L 433.96 160.83 C420.01,176.55 400.56,192.81 382.00,204.26 C364.97,214.77 337.07,225.84 322.18,227.99 ZM 289.50 214.07 C296.28,215.14 311.28,214.24 318.00,212.36 C334.26,207.81 350.33,194.36 357.87,179.00 C367.75,158.85 367.04,136.96 355.86,117.19 C351.91,110.21 341.31,99.64 333.78,95.18 C319.79,86.90 300.28,83.76 286.00,87.49 C270.55,91.52 255.68,101.70 247.71,113.68 C230.18,140.05 232.72,172.00 254.15,194.50 C263.76,204.60 277.42,212.16 289.50,214.07 ZM 310.56 177.32 C296.59,182.09 281.36,176.28 274.80,163.69 C273.01,160.26 272.60,157.75 272.56,149.87 C272.50,140.32 272.53,140.20 276.31,134.72 C282.42,125.84 289.73,121.99 300.40,122.01 C309.94,122.04 311.00,122.55 311.00,127.17 C311.00,135.05 315.94,140.00 323.83,140.00 C327.42,140.00 327.80,140.26 328.38,143.12 C329.47,148.59 329.05,155.49 327.32,160.56 C325.07,167.17 317.17,175.07 310.56,177.32 ZM 227.00 191.30 C231.12,193.87 234.86,195.98 235.30,195.99 C235.74,195.99 234.55,193.19 232.65,189.75 C219.03,165.04 219.16,134.87 232.99,110.37 C234.65,107.42 235.63,105.00 235.16,105.00 C233.80,105.00 217.18,115.64 209.50,121.43 C202.72,126.54 178.79,148.33 178.22,149.92 C178.06,150.35 183.09,155.67 189.41,161.74 C201.38,173.25 214.26,183.38 227.00,191.30 ZM 369.95 185.83 L 365.04 196.16 L 369.77 193.40 C383.49,185.39 401.43,171.25 413.97,158.58 L 422.43 150.03 L 418.47 145.90 C411.33,138.48 393.30,123.31 383.80,116.73 C373.73,109.76 365.00,104.48 365.00,105.36 C365.00,105.66 366.26,108.07 367.80,110.71 C375.08,123.16 378.00,134.63 378.00,150.82 C378.00,165.82 376.63,171.78 369.95,185.83 ZM 302.07 147.37 C303.45,149.11 305.11,150.00 307.00,150.00 C309.86,150.00 314.00,146.16 314.00,143.50 C314.00,140.84 309.86,137.00 307.00,137.00 C304.14,137.00 300.00,140.84 300.00,143.50 C300.00,144.18 300.93,145.92 302.07,147.37 Z" fill="hsla(0, 0%, 100%, 1.00)"/>
</g>
</svg>`;

    // Icon 2 (Simple State - Click to Complicate)
    // 480x480 original viewBox.
    const ICON_SIMPLE = `<svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 480 480" fill="currentColor">
<g>
<path d="M 264.82 270.52 C256.78,272.09 231.63,273.29 225.50,272.40 C208.56,269.94 197.02,266.81 183.15,260.90 C156.96,249.73 131.82,227.31 118.13,202.92 C114.32,196.12 114.24,194.06 117.63,190.03 C119.98,187.24 120.76,186.93 124.88,187.20 L 129.50 187.50 L 136.39 198.00 C144.20,209.89 159.76,226.17 169.73,232.86 C178.69,238.88 193.38,246.22 201.50,248.74 C218.89,254.13 241.10,255.81 258.50,253.06 C294.00,247.43 326.10,225.65 343.96,195.06 C347.12,189.65 348.72,187.92 351.35,187.05 C357.24,185.11 363.00,188.96 363.00,194.84 C363.00,202.76 346.20,225.61 330.54,239.00 C312.43,254.48 288.71,265.86 264.82 270.52 ZM 127.81 303.21 C118.79,313.66 105.51,303.27 113.33,291.89 C116.69,286.99 120.76,281.38 126.86,273.21 L 132.22 266.03 L 136.36 269.05 C138.64,270.70 141.94,273.28 143.70,274.78 L 146.89 277.50 L 139.00 288.44 C134.66,294.46 129.62,301.11 127.81,303.21 ZM 364.02 305.49 C357.54,308.84 354.82,306.83 342.50,289.62 C338.65,284.25 334.92,279.03 334.20,278.03 C333.04,276.41 333.64,275.64 340.09,270.64 C344.04,267.56 347.68,265.30 348.18,265.61 C348.67,265.91 350.07,267.64 351.29,269.45 C352.50,271.26 356.99,277.61 361.25,283.55 C369.13,294.54 370.28,297.73 367.97,302.06 C367.40,303.11 365.63,304.66 364.02,305.49 ZM 182.90 334.25 C179.69,336.90 173.45,336.55 170.45,333.55 C167.42,330.51 167.26,326.12 169.91,318.79 C170.96,315.88 173.26,309.00 175.01,303.50 C176.76,298.00 178.32,293.36 178.49,293.19 C179.01,292.65 196.00,298.20 196.00,298.90 C196.00,299.27 193.53,306.98 190.51,316.03 C186.93,326.77 184.28,333.11 182.90,334.25 ZM 307.93 334.54 C303.66,336.75 298.91,336.01 296.18,332.71 C294.31,330.47 283.89,298.70 284.75,297.92 C285.99,296.80 299.92,292.81 301.15,293.22 C301.79,293.43 304.48,300.33 307.13,308.55 C313.34,327.76 313.46,331.68 307.93,334.54 ZM 245.74 344.47 C243.47,346.06 237.29,346.52 235.44,345.23 C234.86,344.83 233.62,343.39 232.69,342.03 C231.26,339.93 231.00,336.84 231.00,321.78 L 231.00 304.00 L 248.69 304.00 L 249.35 319.75 C250.07,336.90 249.33,341.96 245.74,344.47 Z" fill="hsla(0, 0%, 100%, 1.00)"/>
</g>
</svg>`;

    function setMode(isSimple) {
        if (isSimple) {
            document.body.classList.add(BODY_CLASS);
            localStorage.setItem(STORAGE_KEY, 'true');
        } else {
            document.body.classList.remove(BODY_CLASS);
            localStorage.setItem(STORAGE_KEY, 'false');
        }
        updateButton(isSimple);
    }

    function updateButton(isSimple) {
        const btn = document.getElementById(BTN_ID);
        if (!btn) return;

        // If Simple Mode is ON, we show the icon to turn it OFF (which might be the simple icon or complex icon depending on preference). 
        // User said: "logo [ICON 2] to turn simplified view off". So when isSimple=true, show ICON 2.
        // "icon [ICON 1] to turn simplified on". So when isSimple=false, show ICON 1.

        btn.innerHTML = isSimple ? ICON_SIMPLE : ICON_COMPLEX;
        btn.setAttribute('aria-label', isSimple ? 'Turn off Simplified View' : 'Turn on Simplified View');
        btn.setAttribute('title', isSimple ? 'Turn off Simplified View' : 'Turn on Simplified View');
    }

    // Initialize
    const savedMode = localStorage.getItem(STORAGE_KEY) === 'true';
    if (savedMode) {
        document.body.classList.add(BODY_CLASS);
    }

    // Bind Event
    document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById(BTN_ID);
        if (btn) {
            updateButton(savedMode); // Set initial icon
            btn.addEventListener('click', () => {
                const isCurrentlySimple = document.body.classList.contains(BODY_CLASS);
                setMode(!isCurrentlySimple);
            });
        }
    });

    // Immediate execution for body class to prevent flash
    setMode(savedMode);

})();
